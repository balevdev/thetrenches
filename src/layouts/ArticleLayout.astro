---
import BaseLayout from './BaseLayout.astro';
import Header from '../components/layout/Header.astro';
import Footer from '../components/layout/Footer.astro';
import ProgressBar from '../components/layout/ProgressBar.astro';
import ArticleHeader from '../components/blog/ArticleHeader.astro';
import TableOfContents from '../components/blog/TableOfContents.astro';
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'blog'>;
  headings: Array<{ depth: number; slug: string; text: string }>;
}

const { post, headings } = Astro.props;
const { title, subtitle, description, pubDate, category, readTime, heroImage, ogImage } = post.data;
---

<BaseLayout
  title={title}
  description={description}
  ogImage={ogImage || heroImage}
  ogType="article"
  publishedTime={pubDate.toISOString()}
>
  <Header slot="header" />
  <ProgressBar />

  <article class="article">
    <ArticleHeader
      title={title}
      subtitle={subtitle}
      category={category}
      pubDate={pubDate}
      readTime={readTime}
      heroImage={heroImage}
    />

    <div class="article__layout">
      <div class="article__toc">
        <TableOfContents headings={headings} />
      </div>

      <div class="article__content">
        <slot />
      </div>
    </div>

    <footer class="article__footer">
      <div class="article__share">
        <h4>Share this article</h4>
        <div class="article__share-buttons">
          <a
            href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(Astro.url.href)}`}
            target="_blank"
            rel="noopener noreferrer"
            class="btn btn--ghost"
            aria-label="Share on Twitter"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"></path>
            </svg>
            Twitter
          </a>
          <a
            href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(Astro.url.href)}`}
            target="_blank"
            rel="noopener noreferrer"
            class="btn btn--ghost"
            aria-label="Share on LinkedIn"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
              <rect width="4" height="12" x="2" y="9"></rect>
              <circle cx="4" cy="4" r="2"></circle>
            </svg>
            LinkedIn
          </a>
        </div>
      </div>
    </footer>
  </article>

  <Footer slot="footer" />
</BaseLayout>

<style>
  .article {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: 0 var(--container-padding);
  }

  .article__layout {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-12);
    max-width: var(--content-width);
    margin: 0 auto;
  }

  @media (min-width: 1024px) {
    .article__layout {
      /* Content area + gap + TOC width */
      max-width: calc(var(--content-width) + var(--space-12) + 220px);
      grid-template-columns: var(--content-width) 220px;
    }
  }

  .article__toc {
    display: none;
  }

  @media (min-width: 1024px) {
    .article__toc {
      display: block;
      order: 2;
    }
  }

  .article__content {
    max-width: var(--content-width);
    order: 1;
    width: 100%;
  }

  /* Article content typography */
  .article__content :global(h2) {
    margin-top: var(--space-16);
    margin-bottom: var(--space-6);
    scroll-margin-top: calc(var(--header-height) + var(--space-8));
  }

  .article__content :global(h3) {
    margin-top: var(--space-10);
    margin-bottom: var(--space-4);
    scroll-margin-top: calc(var(--header-height) + var(--space-8));
  }

  .article__content :global(p) {
    margin-bottom: var(--space-6);
  }

  .article__content :global(ul),
  .article__content :global(ol) {
    margin-bottom: var(--space-6);
  }

  .article__content :global(blockquote) {
    margin: var(--space-10) 0;
  }

  .article__content :global(pre) {
    margin: var(--space-8) 0;
  }

  .article__content :global(img) {
    border-radius: var(--radius-lg);
    margin: var(--space-8) 0;
  }

  .article__content :global(hr) {
    margin: var(--space-12) 0;
  }

  /* Wide elements */
  .article__content :global(.wide) {
    max-width: var(--wide-width);
    margin-left: 50%;
    transform: translateX(-50%);
    width: 100vw;
    padding: 0 var(--container-padding);
  }

  @media (min-width: 1024px) {
    .article__content :global(.wide) {
      width: auto;
      padding: 0;
      margin-left: calc(-1 * (var(--wide-width) - var(--content-width)) / 2);
      transform: none;
    }
  }

  .article__footer {
    max-width: var(--content-width);
    margin: var(--space-12) auto 0;
    padding-top: var(--space-8);
    border-top: 1px solid var(--border-subtle);
  }

  .article__share h4 {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    text-transform: uppercase;
    letter-spacing: var(--tracking-widest);
    color: var(--text-tertiary);
    margin: 0 0 var(--space-4);
  }

  .article__share-buttons {
    display: flex;
    gap: var(--space-3);
    flex-wrap: wrap;
  }

  .article__share-buttons .btn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
  }
</style>
