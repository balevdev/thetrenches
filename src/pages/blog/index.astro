---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer.astro';
import ArticleCard from '../../components/blog/ArticleCard.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog', ({ data }) => {
  return data.draft !== true;
})).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout
  title="Articles"
  description="Technical articles on data engineering, infrastructure economics, and system design."
>
  <Header slot="header" />

  <div class="blog-index">
    <header class="blog-header">
      <h1>Articles</h1>
      <p class="lead">
        Deep dives into data architecture, infrastructure economics, and practical engineering insights.
      </p>
    </header>

    {posts.length > 0 ? (
      <div class="article-grid">
        {posts.map(post => (
          <ArticleCard
            title={post.data.title}
            description={post.data.description}
            href={`/blog/${post.slug}`}
            pubDate={post.data.pubDate}
            category={post.data.category}
            readTime={post.data.readTime}
            tags={post.data.tags}
            heroImage={post.data.heroImage}
          />
        ))}
      </div>
    ) : (
      <div class="blog-empty">
        <p>No articles yet. Check back soon!</p>
      </div>
    )}
  </div>

  <Footer slot="footer" />
</BaseLayout>

<style>
  .blog-index {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: var(--space-12) var(--container-padding);
  }

  .blog-header {
    max-width: var(--content-width);
    margin: 0 auto var(--space-12);
    text-align: center;
  }

  .blog-header h1 {
    margin-top: 0;
    margin-bottom: var(--space-4);
  }

  .article-grid {
    display: grid;
    gap: var(--space-8);
    grid-template-columns: repeat(auto-fit, minmax(min(100%, 320px), 1fr));
  }

  .blog-empty {
    text-align: center;
    padding: var(--space-16) 0;
    color: var(--text-tertiary);
  }
</style>
